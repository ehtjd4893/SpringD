<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team.d.dao.ReservationDAO">

	<!-- 예약할수 있는 방  -->
	<select id="remainingRoom" resultType="com.team.d.dto.RoomDTO">
	 SELECT DISTINCT r.RNO,r.RNAME,r.RPRICE,r.RGRADE,r.RIMG,r.RACCEPT,r.RSIZE
		FROM SPRING.ROOM r LEFT OUTER JOIN SPRING.RESERVATION v
		ON r.RNO = v.RNO
		WHERE (v.CHECKIN  IS NULL OR v.CHECKOUT IS NULL)
              OR (v.CHECKIN  NOT BETWEEN TO_DATE(#{param1},'YYYY-MM-DD') AND TO_DATE(#{param2},'YYYY-MM-DD')
			  AND v.CHECKOUT NOT BETWEEN  TO_DATE(#{param1},'YYYY-MM-DD') AND TO_DATE(#{param2},'YYYY-MM-DD')
			  AND r.RACCEPT>=#{param3})
		ORDER BY r.RNO ASC
	</select>
	
	<!-- 예약한 방 정보 -->
	<select id="selectRoom" resultType="com.team.d.dto.RoomDTO">
		SELECT RNO, RNAME, RPRICE, RGRADE, RIMG, RACCEPT, RSIZE
		FROM SPRING.ROOM
		WHERE RNO = #{rNo}
	</select>
	
	<!-- 예약정보 삽입 -->
	<insert id="insertReservation" >
		INSERT INTO SPRING.RESERVATION
		VALUES (SPRING.RESERVATION_SEQ.NEXTVAL,#{param1},#{param2},#{param3},#{param4},#{param5},#{param6},#{param7},#{param8},#{param9},#{param10},'예약중')
	</insert>
	
	<!-- 예약정보 뽑아오는 함수 -->
	<select id="selectViewReservation" resultType="long">
		SELECT RENO
		FROM SPRING.RESERVATION 
		WHERE RENO=(SELECT MAX(RENO) FROM SPRING.RESERVATION)
	</select>
	
	
	<!-- 예약한 방 정보 -->
	<select id="selectReservation" resultType="com.team.d.dto.ReservationDTO">
		SELECT RENO,RNO, MNO,PEOPLE,CHECKIN,CHECKOUT,FOOD,TOTALPAY,BOOKER,REEMAIL,NOTE
		FROM SPRING.RESERVATION
		WHERE RENO = #{reNo}
	</select>
	
	<!-- 회원의 예약 리스트 -->
	<select id="reservationList" resultType="com.team.d.dto.ReservationDTO">
		SELECT RENO,RNO, MNO,PEOPLE,CHECKIN,CHECKOUT,FOOD,TOTALPAY,BOOKER,REEMAIL,NOTE,STATE
		FROM SPRING.RESERVATION
		WHERE MNO = #{mNo}
	</select>
	
	
	<update id="cancelReservation">
		UPDATE SPRING.RESERVATION
		SET	STATE='취소'
		WHERE RENO=#{param1}
	</update>
	
</mapper>